# 守望影神图集案器项目规划

## 1. 项目概述

### 1.1 项目背景
守望影神图集案器是一个专为Stable Diffusion等AI绘图工具设计的本地图集管理桌面应用，旨在帮助AI绘图创作者高效管理作品与提示词。

### 1.2 目标用户
- AI绘图创作者
- 设计师
- 内容创作者

### 1.3 核心问题
- AI绘图作品与提示词的配对管理困难
- 搜索效率低
- 缺乏结构化组织

## 2. 系统功能

### 2.1 主要功能
- **数据单元组管理**：图片与txt文件自动配对，一键管理提示词
- **智能搜索**：支持按文件名、文件夹名、提示词内容搜索，优先搜索单元名
- **分层导航**：树形文件夹结构，支持无限层级嵌套
- **批量操作**：支持拖拽上传、复制、编辑、删除

### 2.2 关键特性
- 深色主题界面，适合长时间使用
- 响应式布局（每行7张卡片，9:16比例）
- 图片懒加载与缩略图优化
- 即时预览、Ctrl+V粘贴创建、状态保持
- 一键启动（双击bat文件）

## 3. 技术架构

### 3.1 架构图
基于Flask的前后端分离架构，前端HTML/CSS/JS + 后端Python Flask，数据存储基于文件系统。

### 3.2 设计模式
- **模块化设计**：后端代码拆分为多个模块（app.py、routes.py、utils.py等）
- **MVC模式**：Flask框架支持的MVC结构，分离模型、视图和控制器
- **单例模式**：配置模块（config.py）作为全局配置中心

### 3.3 主要组件交互
- 前端通过HTTP请求与Flask后端通信
- 后端处理请求并调用file_operations.py进行文件操作
- 配置模块提供全局配置参数
- 工具模块提供通用辅助函数

## 4. 技术选型

### 4.1 前端技术
- HTML5 + CSS3 + JavaScript (ES6)
- Tailwind CSS样式框架

### 4.2 后端技术
- Python + Flask >=2.0.0

### 4.3 图像处理
- PIL (Pillow) >=8.0.0

### 4.4 数据存储
- 文件系统（图片 + txt配对）

### 4.5 版本要求
- Python 3.7+
- Flask 2.0+
- Pillow 8.0+

## 5. 项目目录结构

```
守望影神图集案器/
├── backend/              # 后端模块化代码
│   ├── __init__.py
│   ├── app.py            # Flask应用创建
│   ├── config.py         # 配置模块
│   ├── file_operations.py # 文件操作模块
│   ├── routes.py         # 路由模块
│   └── utils.py          # 工具函数模块
├── src/                  # 前端源码目录
│   ├── index.html        # 前端界面
│   ├── script.js         # 前端逻辑
│   └── styles.css        # 样式文件
├── images/               # 图片存储目录
├── thumbnails/           # 缩略图缓存目录
├── demo.py              # Flask后端服务入口
├── 启动守望影神图集案器.bat  # 完整启动脚本
├── 停止服务器.bat         # 停止服务器脚本
└── check_routes.py      # 路由检查工具
```

## 6. 核心模块详解

### 6.1 后端模块

#### 6.1.1 app.py (Flask应用创建)
- 创建Flask应用实例
- 注册路由
- 添加全局错误处理
- 启动时后台生成所有缩略图

#### 6.1.2 config.py (配置模块)
- 定义图片目录和缩略图目录
- 定义允许的文件扩展名
- 确保目录存在
- 提供线程锁防止并发问题

#### 6.1.3 routes.py (路由模块)
- 注册所有API路由
- 提供主页和静态文件服务
- 实现数据获取、搜索、缩略图、原图等API
- 实现单元创建、更新、删除功能
- 实现文件夹创建、重命名功能

#### 6.1.4 utils.py (工具函数模块)
- 获取安全文件名
- 创建缩略图
- 获取目录树结构
- 获取目录中的文件列表
- 全局搜索文件名和内容
- 批量生成所有图片的缩略图

#### 6.1.5 file_operations.py (文件操作模块)
- 获取单个单元详情
- 创建新单元
- 更新单元
- 删除单元

#### 6.1.6 demo.py (应用入口)
- 将backend目录添加到Python路径
- 创建应用实例
- 启动Flask服务器

### 6.2 前端模块

#### 6.2.1 index.html (前端界面)
- 响应式布局设计
- 包含头部、侧边栏、内容区域
- 搜索功能界面
- 单元卡片展示区域
- 编辑模态框
- 文件夹模态框
- 加载状态和拖拽区域

#### 6.2.2 script.js (前端逻辑)
- ImageGalleryApp类实现前端应用逻辑
- 数据加载和分页处理
- 搜索功能实现
- 图片懒加载优化
- 单元编辑、创建、删除功能
- 文件夹创建和重命名功能
- 拖拽上传和粘贴创建功能
- 状态保持和本地存储

#### 6.2.3 styles.css (样式文件)
- 深色主题设计
- 卡片样式和网格布局
- 树形导航样式
- 模态框和加载动画样式
- 拖拽区域和滚动条样式

## 7. 启动和部署

### 7.1 启动方式
- 双击运行 `启动守望影神图集案器.bat`
- 或手动运行 `python demo.py`

### 7.2 停止方式
- 运行 `停止服务器.bat`

### 7.3 部署方式
- 本地运行，浏览器访问 http://localhost:5000

## 8. 开发环境

### 8.1 必需工具
- Windows 10/11
- Python 3.7+
- 文本编辑器（如VS Code）

### 8.2 可选工具
- Git（用于版本控制）
- Tailwind CSS（样式框架）

## 9. 性能优化

### 9.1 图片处理优化
- 缩略图缓存机制
- 懒加载技术
- 图片预加载优化

### 9.2 数据加载优化
- 分页加载机制
- 无限滚动实现
- 数据缓存策略

## 10. 安全考虑

### 10.1 路径安全
- 路径遍历攻击防护
- 文件访问权限控制

### 10.2 数据安全
- 输入验证和过滤
- 文件名安全处理

## 11. 未来规划

### 11.1 功能增强
- 标签系统
- 云端同步
- 更高级的搜索功能
- 批量操作优化

### 11.2 性能优化
- 更高效的图片处理算法
- 数据库集成替代文件系统
- 更智能的缓存机制

### 11.3 用户体验
- 更丰富的界面交互
- 移动端适配
- 多语言支持